<div>
  <button
    (click)="toggleMobileMenu()"
    class="fixed top-4 left-4 z-40 md:hidden p-2 hover:bg-muted rounded-lg transition-colors"
    aria-label="Toggle menu"
  >
    <ng-container *ngIf="isMobileMenuOpen; else menuIcon">
      <svg
        class="w-6 h-6"
        fill="none"
        stroke="currentColor"
        viewBox="0 0 24 24"
      >
        <path
          stroke-linecap="round"
          stroke-linejoin="round"
          stroke-width="2"
          d="M6 18L18 6M6 6l12 12"
        ></path>
      </svg>
    </ng-container>
    <ng-template #menuIcon>
      <svg
        class="w-6 h-6"
        fill="none"
        stroke="currentColor"
        viewBox="0 0 24 24"
      >
        <path
          stroke-linecap="round"
          stroke-linejoin="round"
          stroke-width="2"
          d="M4 6h16M4 12h16M4 18h16"
        ></path>
      </svg>
    </ng-template>
  </button>

  <aside
    [ngClass]="{
      'fixed top-0 left-0 z-30 h-screen w-64 bg-sidebar border-r border-sidebar-border transition-transform duration-300 flex flex-col md:translate-x-0': true,
      'translate-x-0': isMobileMenuOpen,
      '-translate-x-full md:translate-x-0': !isMobileMenuOpen
    }"
  >
    <div class="p-6 border-b border-sidebar-border">
      <div class="flex items-center gap-3">
        <div class="text-2xl">
          <svg
            class="w-8 h-8 text-primary"
            viewBox="0 0 24 24"
            fill="currentColor"
          >
            <path
              d="M12 2L2 7v10c0 5.55 3.84 10.74 9 12 5.16-1.26 9-6.45 9-12V7l-10-5zm0 18.5c-4.28-1.1-7.5-5.25-7.5-9.5V8.5l7.5-3.75 7.5 3.75v2.5c0 4.25-3.22 8.4-7.5 9.5z"
            ></path>
          </svg>
        </div>
        <div>
          <h2 class="font-bold text-lg text-sidebar-foreground">{{ title }}</h2>
          <p class="text-xs text-sidebar-foreground/60">{{ subtitle }}</p>
        </div>
      </div>
    </div>

    <nav class="flex-1 overflow-y-auto p-4 space-y-2">
      <ng-container *ngFor="let item of items; trackBy: trackByHref">
        <div *ngIf="item.children && item.children.length > 0">
          <button
            (click)="toggleExpanded(item.href)"
            type="button"
            [ngClass]="{
              'w-full flex items-center gap-3 px-4 py-3 rounded-lg transition-colors text-sidebar-foreground hover:bg-sidebar-accent': true,
              'bg-sidebar-primary text-sidebar-primary-foreground font-medium':
                isActive(item.href)
            }"
          >
            <span
              *ngIf="item.icon"
              class="flex-shrink-0"
              [innerHTML]="item.icon"
            ></span>
            <span class="flex-1 text-left text-sm">{{ item.title }}</span>
            <svg
              [ngClass]="{
                'w-4 h-4 transition-transform': true,
                'rotate-180': isExpanded(item.href)
              }"
              fill="none"
              stroke="currentColor"
              viewBox="0 0 24 24"
            >
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                stroke-width="2"
                d="M19 9l-7 7-7-7"
              ></path>
            </svg>
          </button>

          <div
            *ngIf="isExpanded(item.href)"
            class="ml-6 mt-2 space-y-2 border-l-2 border-sidebar-primary/30 pl-0"
          >
            <ng-container
              *ngFor="let child of item.children; trackBy: trackByHref"
            >
              <a
                [routerLink]="child.href"
                (click)="closeMobileMenu()"
                [ngClass]="{
                  'flex items-center gap-3 px-4 py-2 rounded-lg transition-colors text-sidebar-foreground text-sm hover:bg-sidebar-accent': true,
                  'bg-sidebar-primary/20 text-sidebar-primary font-medium':
                    isActive(child.href)
                }"
              >
                <span
                  *ngIf="child.icon"
                  class="flex-shrink-0"
                  [innerHTML]="child.icon"
                ></span>
                <span>{{ child.title }}</span>
              </a>
            </ng-container>
          </div>
        </div>

        <div *ngIf="!item.children || item.children.length === 0">
          <a
            [routerLink]="item.href"
            (click)="closeMobileMenu()"
            [ngClass]="{
              'flex items-center gap-3 px-4 py-3 rounded-lg transition-colors text-sidebar-foreground hover:bg-sidebar-accent': true,
              'bg-sidebar-primary text-sidebar-primary-foreground font-medium':
                isActive(item.href)
            }"
          >
            <span
              *ngIf="item.icon"
              class="flex-shrink-0"
              [innerHTML]="item.icon"
            ></span>
            <span class="text-sm">{{ item.title }}</span>
          </a>
        </div>
      </ng-container>
    </nav>

    <div class="p-4 border-t border-sidebar-border">
      <div class="p-3 rounded-lg bg-sidebar-accent/20">
        <p class="text-xs font-medium text-sidebar-primary">Status: Active</p>
        <p class="text-xs text-sidebar-foreground/60 mt-1">
          Connected & Synced
        </p>
      </div>
    </div>
  </aside>

  <div
    *ngIf="isMobileMenuOpen"
    class="fixed inset-0 z-20 bg-black/50 md:hidden"
    (click)="closeMobileMenu()"
  ></div>
</div>
